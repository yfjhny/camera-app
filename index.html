<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>2秒録画テスト</title>
</head>
<body>
  <h2>2秒録画テスト（iPhone対応）</h2>

  <video id="camera" autoplay playsinline muted width="300"></video><br><br>
  <button id="recordBtn">2秒だけ録画する</button><br><br>
  <video id="recorded" controls width="300"></video>

  <script>
    let mediaRecorder;
    let recordedChunks = [];

    const camera = document.getElementById('camera');
    const recorded = document.getElementById('recorded');
    const recordBtn = document.getElementById('recordBtn');

    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        camera.srcObject = stream;

        recordBtn.onclick = () => {
          recordedChunks = [];
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.ondataavailable = e => {
            if (e.data.size > 0) {
              recordedChunks.push(e.data);
            }
          };

          mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: "video/webm" });
            recorded.src = URL.createObjectURL(blob);
            recorded.play();
          };

          mediaRecorder.start();                      // 撮影スタート
          recordBtn.disabled = true;

          setTimeout(() => {
            mediaRecorder.stop();                    // 2秒後に自動停止
            recordBtn.disabled = false;
          }, 2000); // 2秒間録画
        };
      })
      .catch(err => {
        alert('カメラが使えません: ' + err);
      });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>2秒録画テスト</title>
</head>
<body>
  <h2>2秒録画テスト（iPhone対応）</h2>

  <video id="camera" autoplay playsinline width="300"></video><br><br>
  <button id="recordBtn">2秒だけ録画する</button><br><br>
  <video id="recorded" controls width="300"></video>

  <script>
    (() => {
      const camera = document.getElementById('camera');
      const recorded = document.getElementById('recorded');
      const recordBtn = document.getElementById('recordBtn');

      let mediaRecorder;
      let recordedChunks = [];

      navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
          camera.srcObject = stream;
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.ondataavailable = function(e) {
            if (e.data.size > 0) {
              recordedChunks.push(e.data);
            }
          };

          mediaRecorder.onstop = function() {
            const blob = new Blob(recordedChunks, { type: "video/webm" });
            recorded.src = URL.createObjectURL(blob);
            recordedChunks = [];
          };

          recordBtn.onclick = () => {
            mediaRecorder.start();
            recordBtn.disabled = true;
            setTimeout(() => {
              mediaRecorder.stop();
              recordBtn.disabled = false;
            }, 2000);
          };
        })
        .catch(err => {
          alert('カメラが使えません: ' + err);
        });
    })();
  </script>
</body>
</html>
